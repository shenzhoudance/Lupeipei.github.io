<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Learning is doing">
<meta property="og:type" content="website">
<meta property="og:title" content="Lucia">
<meta property="og:url" content="http://lupeipei.github.io/index.html">
<meta property="og:site_name" content="Lucia">
<meta property="og:description" content="Learning is doing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lucia">
<meta name="twitter:description" content="Learning is doing">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lupeipei.github.io/"/>





  <title> Lucia </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lucia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2018/01/04/how-to-get-step-name-in-cucumber/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/04/how-to-get-step-name-in-cucumber/" itemprop="url">
                  如何获取cucumber中step的name？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-04T16:26:32+08:00">
                2018-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cucumber/" itemprop="url" rel="index">
                    <span itemprop="name">Cucumber</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/04/how-to-get-step-name-in-cucumber/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/04/how-to-get-step-name-in-cucumber/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>用cucumber测试时，有一个需求，就是提取每个step的name，以及对应的scenario和feature的name。</p>
<p>Google了不少，也试过几个前人提供的方法， 屡屡败北，在坑里挣扎了两天， 发现这方面的资料其实还是挺少的，特别是ruby这块，记录下这趟比较揪心的求解过程，给需要的提供个参考。「我揪心就好了，大伙就别再揪心了。」</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p><a href="https://github.com/cucumber/cucumber/wiki/Hooks" target="_blank" rel="external">cucumber hooks</a> 中提到了多个hook，包括before，after，但是对于step hooks，只有一个AfterStep， 看AfterStep 的用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">AfterStep do |scenario|</div><div class="line">  # Do something after each step.</div><div class="line">end</div></pre></td></tr></table></figure>
<p>官方文档是这么写的，可是你会发现根本不是那么回事。「吐槽下：文档没有及时更新让人很是心塞啊」</p>
<p>在你的<code>feature/support</code>目录下，新建一个文件<code>hooks.rb</code>,  添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Before do |scenario|</div><div class="line">  # do something before scenario</div><div class="line">end</div><div class="line"></div><div class="line">AfterStep do |scenario|</div><div class="line">	puts scenario.methods</div><div class="line">	puts scenario.class</div><div class="line">  # Do something after each step.</div><div class="line">end</div></pre></td></tr></table></figure>
<p>终端运行<code>cucumber</code>的时候，你会发现AfterStep中根本不是scenario，得到的是这样的结果：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fn4lejzw3uj30pt06un03.jpg" alt=""></p>
<p>这里可以看到它的class是<code>Cucumber::Core::Test::Result::Passed</code>， method里面也没有任何name,text之类。那么，每次afterstep后，返回的<code>Cucumber::Core::Test::Result::Passed</code>是个什么鬼？是个step？</p>
<p>看源码：<a href="http://www.rubydoc.info/github/cucumber/cucumber-ruby-core/Cucumber/Core/Test/Result/Passed" target="_blank" rel="external">Class: Cucumber::Core::Test::Result::Passed</a>,  cucumber中每个step运行后，其实有7种情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[:failed, :flaky, :skipped, :undefined, :pending, :passed, :unknown]</div></pre></td></tr></table></figure>
<p>而passed只是其中的一个type，它不是一个step。看cucumber的doc，可以找到<a href="http://www.rubydoc.info/github/cucumber/cucumber-ruby-core/Cucumber/Core/Test/Step" target="_blank" rel="external">step</a>， 里面的text字段，这正是我们想要的：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fn4lu77docj30qx0hzack.jpg" alt=""></p>
<p>可是如何获取到step呢？</p>
<p>你Google后会发现有一些可能”有用”的解决方法，列出几个我觉得特别的：</p>
<ul>
<li>最奇葩的解答：<a href="https://stackoverflow.com/questions/29952911/how-can-i-access-a-cucumber-step-name-in-the-step-definition" target="_blank" rel="external">How can I access a Cucumber step name in the step definition?</a></li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fn4mmez9oej30j008jjsl.jpg" alt=""></p>
<p>​    「竟然直接在step definition里面添加argument，然后在每个step里面添加一行代码 ‘puts step_name ‘, 且            不说这种方法能不能正常运行，你这样每个step都加，成千上万的steps，手都要断吧？」</p>
<ul>
<li><p>有坑的解答：<a href="https://groups.google.com/forum/#!topic/cukes/TQLcKQqLsjw" target="_blank" rel="external">Get current step within step</a></p>
<p><a href="https://groups.google.com/forum/#!topic/cukes/TQLcKQqLsjw" target="_blank" rel="external">Cukes</a> 上，一个叫Marc Divins的人也遇到这个问题，未解决，身为cucumber backers之一的Matt Wynneg给出了custom formatter的解决建议,  这方法已试过，failed。</p>
</li>
<li><p>版本问题的坑：<a href="https://asyoulook.com/computers%20&amp;%20internet/ruby-get-current-step-form-scenario-outline/1394372" target="_blank" rel="external">get current step from scenario outline</a></p>
<p>这里面用到了Cucumber::Ast::Scenario， 这个在cucumber3.0下运行会报错，无法识别，这是其一，其二是在AfterStep中调用的scenario并没有定义，会报错。</p>
</li>
</ul>
<p>OK，不废话了，直接上解答：</p>
<p>在新建好的<code>features/support/hooks.rb</code> 中，添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Before do |scenario|</div><div class="line">  $step_index = 0</div><div class="line">  $stop_count = scenario.test_steps.count</div><div class="line">  @scenario = scenario</div><div class="line">end</div><div class="line"></div><div class="line">AfterStep do |step|</div><div class="line">  if $step_index &lt; $stop_count</div><div class="line">    puts &quot;steps: #&#123;@scenario.test_steps[$step_index].text&#125;\n&quot;</div><div class="line">  end</div><div class="line">  $step_index += 2</div><div class="line">end</div></pre></td></tr></table></figure>
<p>运行一个feature试试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cucumber features/xxxx.feature</div></pre></td></tr></table></figure>
<p>每个step之后，都会输出了AfterStep中定义的<code>&quot;steps: #{@scenario.test_steps[$step_index].text}\n&quot;</code></p>
<p>类似这样：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fn4n9a82sbj30ey044aaj.jpg" alt=""></p>
<p>说明：</p>
<p>代码上的<code>$step_index += 2</code>， 给step_index累加了2，而不是1， 是因为每输出一个step，后面会跟一个<code>aferstep hook</code>，为了不输出<code>aferstep hook</code>字段，所以累加2。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>参考阅读：</p>
<p><a href="https://github.com/cucumber/cucumber-ruby/issues/450" target="_blank" rel="external">add step to AfterStep</a></p>
<p><a href="https://zsoltfabok.com/blog/2012/09/cucumber-jvm-hooks/" target="_blank" rel="external">cucumber JVM:Hooks</a></p>
<p>P.S.</p>
<p>这次的求解过程，更深刻地感受到一句话的正确性：<strong>不要盯着锁找答案，钥匙在别处</strong>。</p>
<p>P.P.S</p>
<p>Happy coding  and bye bug  : )</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2018/01/02/upload-capybara-screenshot-to-aliyun-oss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/02/upload-capybara-screenshot-to-aliyun-oss/" itemprop="url">
                  将Capybara的screenshot上传至阿里云的OSS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-02T21:43:27+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/aliyun/" itemprop="url" rel="index">
                    <span itemprop="name">aliyun</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/02/upload-capybara-screenshot-to-aliyun-oss/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/02/upload-capybara-screenshot-to-aliyun-oss/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>网页测试中，有一个很棒的gem叫<a href="https://github.com/mattheworiordan/capybara-screenshot" target="_blank" rel="external">capybara-screenshot</a> ，当你的scenario失败时，会自动将网页进行截图。</p>
<p>当然，你也可以手动截图。比如我想看看在step A中，我停留的网页长什么样子，直接用<code>Capybara::Screenshot.screenshot_and_open_image</code>, 终端运行cucumber或者rspec时，就可以看到网页的模样。</p>
<p>截图下来的图片，如果保存在本地，随着scenario的增多，自然会吃不消的，使用云存储是个好选择，比如放在阿里云上，还能通过生成的URL来将截图呈现在网页上，非常棒。</p>
<p>【当然你也可以在capybara中设置<code>Capybara::Screenshot.prune_strategy</code>的值，只保存最后的XX个或者最后一次运行的截图，这样截图就不会很多，但这里不讨论这种情况】</p>
<p>下面，简单来走一走如何将截图上传至阿里云的OSS。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>以howitzer_cucumber的一个登陆测试为例，来看看如何将截图传至阿里云。</p>
<ul>
<li><p>开通阿里云的OSS服务【点击，按照指示下单购买即可】</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fn2kck0bc0j30sa06hwfl.jpg" alt=""></p>
</li>
<li><p>新建存储空间bucket，获取你的aliyun_access_key， aliyun_secret_key，host【存储空间概览下面的endpoint】</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fn2kfi4tsvj30wa03ldgq.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>在gemfile中添加<code>gem &#39;aliyun-oss-sdk&#39;</code>, 终端运行<code>bundle install</code></p>
</li>
<li><p>在 <code>features/support</code>中新建文件<code>aliyun.rb</code>，试试上传一张图片：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">require &apos;aliyun/oss&apos;</div><div class="line">aliyun_access_key = &quot;你的access_key&quot;</div><div class="line">aliyun_secret_key = &quot;你的secret_key&quot;</div><div class="line">host = &apos;你的host&apos;</div><div class="line">bucket = &apos;你的bucket&apos;</div><div class="line">client = Aliyun::Oss::Client.new(aliyun_access_key, aliyun_secret_key, host: host, bucket: bucket)</div><div class="line">client.bucket_create_object(&apos;images/image.png&apos;, File.new(/Users/xxx/xxx/image.png), &#123;&apos;Content-Type&apos; =&gt; &apos;image/png&apos; &#125;)</div></pre></td></tr></table></figure>
<p>这里File.new中的参数，是你想要上传的本地图片的文件路径。</p>
<p>终端运行该脚本，在你刚刚新建的bucket中，查看“文件管理”，你会发现已经上传成功，很赞有没有？</p>
</li>
<li><p>接着我们上传截图，比如登陆测试的scenario长这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Scenario: 用户输入正确的邮箱和密码完成登录</div><div class="line">  Given 我是已经注册的用户&quot;管理员张三&quot;</div><div class="line">  And  我在登录页面</div><div class="line">  When 我在登录页面的表格中输入邮箱:&quot;admin@123.com&quot;和密码:&quot;Password123456&quot;</div><div class="line">  And 我点击登录按钮，提交表单</div><div class="line">  Then 我可以看到我已经进入了个人的主页</div></pre></td></tr></table></figure>
<p>现在我要截图一下登陆页面，可以这么来， 在对应的step的定义中，添加代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">And(/^我在登录页面$/) do</div><div class="line">  LoginPage.open</div><div class="line"> + LoginPage.on do</div><div class="line"> +   file = Capybara::Screenshot.screen_shot_and_save_page</div><div class="line"> + end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>到这里你自然会想到，需要将上传这一步进行封装调用，我们先封装一下图片上传。</p>
<p>考虑到<code>Capybara::Screenshot.screen_shot_and_save_page</code>得到的是一个hash，而我们想要的其实是截图的文件路径，所以用<code>Dir.pwd + file[:image].sub(&#39;.&#39;,&#39;&#39;)</code> 来获取截图路径。</p>
<p>修改<code>aliyun.rb</code>文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">require &apos;aliyun/oss&apos;</div><div class="line"></div><div class="line">aliyun_access_key = &quot;你的access_key&quot;</div><div class="line">aliyun_secret_key = &quot;你的secret_key&quot;</div><div class="line">host = &apos;你的host&apos;</div><div class="line">bucket = &apos;你的bucket&apos;</div><div class="line">$client = Aliyun::Oss::Client.new(aliyun_access_key, aliyun_secret_key, host: host, bucket: bucket)</div><div class="line"></div><div class="line">module AliyunClient</div><div class="line">  module Client</div><div class="line">    def upload_image(filename, file)</div><div class="line">      image_file = Dir.pwd + file[:image].sub(&apos;.&apos;,&apos;&apos;)</div><div class="line">      $client.bucket_create_object(filename, File.new(image_file), &#123;&apos;Content-Type&apos; =&gt; &apos;image/png&apos; &#125;)</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">class Object</div><div class="line">  include AliyunClient::Client</div><div class="line">end</div></pre></td></tr></table></figure>
<p>封装好了，直接调用我们的upload_image吧！</p>
<p>在刚刚的step的定义中，添加代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">And(/^我在登录页面$/) do</div><div class="line">  LoginPage.open</div><div class="line">  LoginPage.on do</div><div class="line">    file = Capybara::Screenshot.screen_shot_and_save_page</div><div class="line"> +   upload(&apos;images/image.png&apos;, file)</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>OK!!</p>
<p>这里，我是上传到images文件夹下，文件名为image.png 。当然具体上传的目标文件及文件夹都是可以自定义的，也是需要自定义的，特别是多次上传，你肯定不希望图片都被覆盖掉了，具体可以查看<a href="https://github.com/aliyun-beta/aliyun-oss-ruby-sdk" target="_blank" rel="external">aliyun-oss-ruby-sdk</a>。</p>
</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://github.com/aliyun-beta/aliyun-oss-ruby-sdk" target="_blank" rel="external">aliyun-oss-ruby-sdk</a></p>
<p><a href="https://github.com/mattheworiordan/capybara-screenshot" target="_blank" rel="external">capybara-screenshot</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/31/web-api-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/31/web-api-practice/" itemprop="url">
                  Rails：Web API接口实作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-31T10:43:45+08:00">
                2017-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/31/web-api-practice/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/31/web-api-practice/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>话说，好记性不如烂笔头「当然，主要是自己笨」，趁着假期，实作了一个简单的API接口，主要是CRUD + auth 认证部分，以加强对API接口部分的理解。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>以用户对一个event活动进行CRUD操作的功能实现为例：</p>
<p>主要按如下步骤走：</p>
<ul>
<li><p>建model event，含字段title, description</p>
</li>
<li><p>设置路由，实作event的get, post, patch ,delete接口</p>
</li>
<li><p>添加认证API</p>
</li>
</ul>
<p><strong>最后的效果是：</strong></p>
<blockquote>
<p> 用户可以通过API接口来新建，修改，查看，删除event</p>
<p>用户在发出新建，修改，删除请求时，需要认证</p>
</blockquote>
<p>P.S：其实可以加个 rspec测试，不过这里我用postman直接测了，省去rspec部分，以免篇幅过长「主要还是因为，呃，你懂的，懒……」</p>
<p>好，开搞吧。</p>
<h5 id="一、新建一个project-event-api"><a href="#一、新建一个project-event-api" class="headerlink" title="一、新建一个project event_api"></a>一、新建一个project event_api</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rails new event_api</div><div class="line">cd event_api</div><div class="line">git init</div></pre></td></tr></table></figure>
<p>生成如下文件：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmz03kpvxxj30970ba74o.jpg" alt=""></p>
<h5 id="二、建event-model，实作CRUD接口"><a href="#二、建event-model，实作CRUD接口" class="headerlink" title="二、建event model，实作CRUD接口"></a>二、建event model，实作CRUD接口</h5><ul>
<li><p>建event model,  终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git checkout -b event # 切换分支，做烂了可以再开个</div><div class="line">rails g model event title:string description:text uuid:string</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>「为了安全性，给event加上一个uuid的字段」</p>
<p>在<code>app/models/event.rb</code>中，给title加上有效性验证，并在创建时自动生成uuid：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class Event &lt; ApplicationRecord</div><div class="line">  validates_presence_of :title</div><div class="line">  before_validation :generate_uuid, :only =&gt; :create</div><div class="line">  def to_param</div><div class="line">  	self.uuid</div><div class="line">  end</div><div class="line"></div><div class="line">  protected</div><div class="line"></div><div class="line">  def generate_uuid</div><div class="line">    self.uuid = SecureRandom.uuid</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>设置路由，在<code>config/routes.rb</code>中添加如下路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">namespace :api, :defaults =&gt; &#123;:format =&gt; :json &#125; do</div><div class="line">  namespace :v1 do</div><div class="line">    resources :events, :only =&gt; [:index, :show, :create, :update, :destroy]</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>产生API controller，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller api --no-assets</div></pre></td></tr></table></figure>
<p>修改<code>app/controllers/api_controller.rb</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- class ApiController &lt; ApplicationController</div><div class="line">+ class ApiController &lt; ActionController::Base</div><div class="line">end</div></pre></td></tr></table></figure>
<p>改成继承自ActionController::Base，因为API 不需要 <code>protect_from_forgery with: :exception</code> 这一行的 CSRF 浏览器安全检查。</p>
</li>
<li><p>实作event的get, post, patch, delete</p>
<p>终端执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller api::v1::events --no-assets</div></pre></td></tr></table></figure>
<p>在<code>app/controllers/api/v1/events_controller.rb</code>中，填入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">class Api::V1::EventsController &lt; ApiController</div><div class="line"></div><div class="line">  def index</div><div class="line">    @events = Event.all</div><div class="line">    render :json =&gt; &#123;</div><div class="line">        :data =&gt; @events.map &#123;|event|</div><div class="line">        &#123;</div><div class="line">            :id =&gt; event.id,</div><div class="line">            :uuid =&gt; event.uuid,</div><div class="line">            :title =&gt; event.title,</div><div class="line">            :event_url =&gt; api_v1_event_url(event.id)</div><div class="line">        &#125;&#125;</div><div class="line">    &#125;</div><div class="line">  end</div><div class="line"></div><div class="line">  def create</div><div class="line">    @event = Event.new(</div><div class="line">                        :title =&gt; params[:title],</div><div class="line">                        :description =&gt; params[:description])</div><div class="line">    if @event.save</div><div class="line">      render :json =&gt; &#123;</div><div class="line">          :id =&gt; @event.id,</div><div class="line">          :uuid =&gt; @event.uuid,</div><div class="line">          :title =&gt; @event.title,</div><div class="line">          :description =&gt; @event.description</div><div class="line">      &#125;</div><div class="line">    else</div><div class="line">      render :json =&gt; &#123;</div><div class="line">          :message =&gt; &quot;创建event失败&quot;, :errors =&gt; @event.errors</div><div class="line">      &#125;, :status =&gt; 400</div><div class="line">    end</div><div class="line">  end</div><div class="line"></div><div class="line">  def show</div><div class="line">    @event = Event.find_by_uuid!(params[:id])</div><div class="line">    render :json =&gt; &#123;</div><div class="line">        :id =&gt; @event.id,</div><div class="line">        :uuid =&gt; @event.uuid,</div><div class="line">        :title =&gt; @event.title,</div><div class="line">        :description =&gt; @event.description</div><div class="line">    &#125;</div><div class="line">  end</div><div class="line"></div><div class="line">  def update</div><div class="line">    @event = Event.find_by_uuid!(params[:id])</div><div class="line">    @event.update(:title =&gt; params[:title],</div><div class="line">                  :description =&gt; params[:description])</div><div class="line">    render :json =&gt; &#123;:message =&gt; &quot;更新event成功&quot;&#125;</div><div class="line">  end</div><div class="line"></div><div class="line">  def destroy</div><div class="line">    @event = Event.find_by_uuid!(params[:id])</div><div class="line">    @event.destroy</div><div class="line">    render :json =&gt; &#123;:message =&gt; &quot;删除event成功&quot;&#125;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>注意，将EventsController 修改为继承自ApiController</p>
<p>启服务器，<code>rails s</code>, 用postman测试看看：</p>
<p>create</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz1uqgyb4j30ms0d2abh.jpg" alt=""></p>
<p>index</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz1vk7e8oj30mi0fmmyj.jpg" alt=""></p>
<p>show：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz1wfaul9j30ms0bs3zj.jpg" alt=""></p>
<p>Update:</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz1x60l41j30mn0c8jsm.jpg" alt=""></p>
<p>发出get请求，看到event的详情中已经修改了title：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmz1yceghkj30mn0bsq41.jpg" alt=""></p>
<p>destroy：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fmz1yvtjybj30mt0a4t9l.jpg" alt=""></p>
<p>看event的list, 发现event2018_updated已经删除：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz213gb40j30mn0de3zp.jpg" alt=""></p>
<p>OK！！</p>
</li>
</ul>
<h5 id="三、添加认证API"><a href="#三、添加认证API" class="headerlink" title="三、添加认证API"></a>三、添加认证API</h5><p>这里做event的API时候，都不需要认证的，让我们加上认证部分。</p>
<ul>
<li><p>装上devise</p>
<p>编辑 <code>Gemfile</code> 加上 <code>gem &quot;devise&quot;</code></p>
<p>终端运行：<code>bundle</code>, 重启服务器，终端执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rails g devise:install</div><div class="line">rails g devise user</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
</li>
<li><p>给event和user挂上关系</p>
<p>在<code>app/models/user.rb</code>加上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">has_many :events</div></pre></td></tr></table></figure>
<p>在<code>app/models/event.rb</code> 加上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">belongs_to :user</div></pre></td></tr></table></figure>
<p> 将user_id添加到event中，终端执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g migration add_user_id_to_events user_id:integer</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>修改<code>app/controllers/api/v1/events_controller.rb</code>， 在create部分填上@event.user = current_user</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">  def create</div><div class="line">    @event = Event.new(</div><div class="line">                        :title =&gt; params[:title],</div><div class="line">                        :description =&gt; params[:description])</div><div class="line">    @event.user = current_user</div><div class="line">    if @event.save</div><div class="line">      render :json =&gt; &#123;</div><div class="line">          :id =&gt; @event.id,</div><div class="line">          :uuid =&gt; @event.uuid,</div><div class="line">          :title =&gt; @event.title,</div><div class="line">          :description =&gt; @event.description</div><div class="line">      &#125;</div><div class="line">    else</div><div class="line">      render :json =&gt; &#123;</div><div class="line">          :message =&gt; &quot;活动创建失败&quot;, :errors =&gt; @event.errors</div><div class="line">      &#125;, :status =&gt; 400</div><div class="line">    end</div><div class="line">  end</div><div class="line">  ......</div></pre></td></tr></table></figure>
<p>这里也可以设置一下show，index部分，添加上creator的字段，显示是谁创建这个event的。「此处略去，不是重点」</p>
</li>
<li><p>给user加上token字段</p>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g migration add_auth_token_to_users</div></pre></td></tr></table></figure>
<p>编辑文件<code>XXXX_add_auth_token_to_users.rb</code>文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class AddAuthTokenToUsers &lt; ActiveRecord::Migration[5.1]</div><div class="line">  def change</div><div class="line">    + add_column :users, :auth_token, :string</div><div class="line">    + add_index :users, :auth_token, :unique =&gt; true</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>编辑<code>app/models/user.rb</code>， 给user加上token:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">class User &lt; ApplicationRecord</div><div class="line">  # Include default devise modules. Others available are:</div><div class="line">  # :confirmable, :lockable, :timeoutable and :omniauthable</div><div class="line">  devise :database_authenticatable, :registerable,</div><div class="line">         :recoverable, :rememberable, :trackable, :validatable</div><div class="line"></div><div class="line">  has_many :events</div><div class="line"></div><div class="line">  before_create :generate_authentication_token</div><div class="line"></div><div class="line">  def generate_authentication_token</div><div class="line">    self.auth_token = Devise.friendly_token</div><div class="line">  end</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>实作注册，登录，登出的API</p>
<p>在 <code>config/routes.rb</code> 加上路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">  namespace :api, :defaults =&gt; &#123;:format =&gt; :json &#125; do</div><div class="line">    namespace :v1 do</div><div class="line">      resources :events, :only =&gt; [:index, :show, :create, :update, :destroy]</div><div class="line">     + post &quot;/signup&quot; =&gt; &quot;auth#signup&quot;</div><div class="line">     + post &quot;/login&quot; =&gt; &quot;auth#login&quot;</div><div class="line">     + post &quot;/logout&quot; =&gt; &quot;auth#logout&quot;</div><div class="line">    end</div><div class="line">  end</div><div class="line">......</div></pre></td></tr></table></figure>
<p>生成auth的controller：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller api::v1::auth --no-assets</div></pre></td></tr></table></figure>
<p>编辑它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">class Api::V1::AuthController &lt; ApiController</div><div class="line">  before_action :authenticate_user!, :only =&gt; [:logout]</div><div class="line"></div><div class="line">  def signup</div><div class="line">    user = User.new(:email =&gt; params[:email], :password =&gt; params[:password])</div><div class="line"></div><div class="line">    if user.save</div><div class="line">      render :json =&gt; &#123;:user_id =&gt; user.id &#125;</div><div class="line">    else</div><div class="line">      render :json =&gt; &#123;:message =&gt; &quot;Failed&quot;, :errors =&gt; user.errors&#125;, :status =&gt; 400</div><div class="line">    end</div><div class="line">  end</div><div class="line"></div><div class="line">  def login</div><div class="line">    if params[:email] &amp;&amp; params[:password]</div><div class="line">      user = User.find_by_email(params[:email])</div><div class="line">    end</div><div class="line">    if user &amp;&amp; user.valid_password?(params[:password])</div><div class="line">      render :json =&gt; &#123;</div><div class="line">          :message =&gt; &quot;ok&quot;,</div><div class="line">          :auth_token =&gt; user.auth_token,</div><div class="line">          :user_id =&gt; user.id</div><div class="line">      &#125;</div><div class="line">    else</div><div class="line">      render :json =&gt; &#123;:message =&gt; &quot;Email or Password is wrong&quot;&#125;, :status =&gt; 400</div><div class="line">    end</div><div class="line">  end</div><div class="line"></div><div class="line">  def logout</div><div class="line">    current_user.generate_authentication_token</div><div class="line">    current_user.save!</div><div class="line">    render :json =&gt; &#123;:message =&gt; &quot;logout successful&quot;&#125;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>编辑<code>app/controllers/api_controller.rb</code>， 添加如下验证：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">before_action :authenticate_user_from_token!</div><div class="line"></div><div class="line">def authenticate_user_from_token!</div><div class="line">  if params[:auth_token]</div><div class="line">    user = User.find_by_auth_token(params[:auth_token])</div><div class="line">    sign_in(user, store: false) if user</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这里可以改成将auth_token放在了header中传递，看这篇<a href="https://lupeipei.github.io/2017/12/29/pass-auth-token-through-header-rails-api/">如何将auth token放入headers进行传递？</a></p>
<p>重启服务器，用postman测试看看：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz38xhtclj30mq0b3t9m.jpg" alt=""></p>
<p>login ,获取auth_token</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz3xbnayjj30n10c40tv.jpg" alt=""></p>
<p>logout, 传递auth_token</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmz3y7tr8nj30mr0acdgs.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>最后，给event添加上认证，修改<code>app/controllers/api/v1/events_controller.rb</code>中，添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">before_action :authenticate_user!, :only =&gt; [:create, :update, :destroy]</div><div class="line">....</div></pre></td></tr></table></figure>
<p>用postman测试看看，现在新建event需要传递一个auth_token才行：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz45zlkyej30mn0bydgy.jpg" alt=""></p>
<p> 添加上auth_token， 创建成功：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz48dnhi8j30mo0dnjsp.jpg" alt=""></p>
<p>Patch, delete同理，可以用postman 进行测试看看，这里就不细看了。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>我这边列出来的都是非常基础的API接口，其他复杂点的都是可以按照这个方式来做的，比如你可以在这个的基础上，添加comment，让用户通过接口给event做评论，点赞，自定义like method等等。</p>
<p>对于routes的写法，上面我用了rails自身的resource方式：<code>resources :events, :only =&gt; [:index, :show, :create, :update, :destroy]</code>， 也用了较易于理解的逐条列出路径的方式：<code>post &quot;/signup&quot; =&gt; &quot;auth#signup&quot;</code>, 可根据实际情况自行选择.</p>
<p>Happy coding! : )</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/29/pass-auth-token-through-header-rails-api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/29/pass-auth-token-through-header-rails-api/" itemprop="url">
                  Rails API：如何将auth token放入headers进行传递？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T15:14:34+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/29/pass-auth-token-through-header-rails-api/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/29/pass-auth-token-through-header-rails-api/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>最近在做Rails API，遇到一个问题：</p>
<blockquote>
<p> 加入用户登录验证后，每次新建一个project时，发出post请求，都要将auth_token放在body中进行传递，如果是get，则将auth_token作为参数放在URL的后面，因为get是没有body的。</p>
</blockquote>
<p>这么做有什么不好呢？</p>
<blockquote>
<p>这导致URL特别长，看着很不清爽，每次用postman发出get请求，都觉得这种做法真的是太太小白了，想着要把auth_token放在headers中才好。</p>
</blockquote>
<p>Google了下，问题解决，附上解决方法。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>以project为例，在postman中，你的请求如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fmxm7liq7rj30u80iztbe.jpg" alt=""></p>
<p> 这时，如果你将auth_token放在headers中进行传递，发出get请求后，会出现error，如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fmxnlzbshrj30ub0etdh6.jpg" alt=""></p>
<p><strong>怎么破？</strong></p>
<p>原先对于user 的auth_token的传递，在<code>api_controller.rb</code>中的定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class ApiController &lt; ActionController::Base</div><div class="line">  before_action :authenticate_user_from_token!</div><div class="line"></div><div class="line">  def authenticate_user_from_token!</div><div class="line">    if params[:auth_token].present?</div><div class="line">      user = User.find_by_authentication_token(params[:auth_token])</div><div class="line">      sign_in(user, store: false) if user</div><div class="line">    end</div><div class="line">  end</div><div class="line">  ......</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这里，可以看到接收的是<code>params[:auth_token]</code>, 我们稍稍修改下，用<code>request.headers[&#39;auth_token&#39;]</code>来代替<code>params[:auth_token]</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class ApiController &lt; ActionController::Base</div><div class="line">  before_action :authenticate_user_from_token!</div><div class="line"></div><div class="line">  def authenticate_user_from_token!</div><div class="line">    if request.headers[&apos;auth_token&apos;]</div><div class="line">      user = User.find_by_authentication_token(request.headers[&apos;auth_token&apos;])</div><div class="line">      sign_in(user, store: false) if user</div><div class="line">    end</div><div class="line">  end</div><div class="line">  ......</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这时，再看看postman, OK !</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fmxncwu45bj30t90hv0vb.jpg" alt=""></p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://www.reddit.com/r/rails/comments/4l3hwv/how_to_send_auth_token_in_header_to_rails_api/" target="_blank" rel="external">How to send auth token in header to Rails API?</a></p>
<p><a href="https://stackoverflow.com/questions/17081499/pass-authenticity-token-through-http-header" target="_blank" rel="external">Pass Authenticity token through http header</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/27/Elizabeth-quotations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/27/Elizabeth-quotations/" itemprop="url">
                  伊丽莎白语录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-27T20:09:03+08:00">
                2017-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/闲言碎语/" itemprop="url" rel="index">
                    <span itemprop="name">闲言碎语</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我怕鬼片</p>
<p>我怕没实体的鬼片</p>
<p>我看鬼片一般都捂着眼睛的……</p>
<p>跟你说果酒啊</p>
<p>可能有些人，就注定胖吧</p>
<p>看来能熬夜是成为老大的必要条件之一啊</p>
<p>欲拒还迎</p>
<p>那你也去啃个西瓜吧</p>
<p>我喜欢英国电影，因为英伦腔听着很好听</p>
<p>喜欢昆汀的电影，因为他的电影经常有大段对白比较话痨</p>
<p>《告白》你觉得恐怖，《杀死比尔》你又觉得正常</p>
<p>我突然想到《热血高校》，我很喜欢的漫改电影</p>
<p>月牙儿说了啊，不能让人卷铺盖睡大街</p>
<p>游泳馆两边都有拿大叉子的工作人员</p>
<p>抓紧，你就十分钟了</p>
<p>广撒网</p>
<p>取一瓢饮</p>
<p>like what</p>
<p>今天是GOT日啊</p>
<p>我很喜欢《银魂》动漫~</p>
<p>同时开两个坑……基本会两个都填不了</p>
<p>恩，我最爱的水果之一，柚子</p>
<p>喜欢薯片，蕃茄味的薯片</p>
<p>嗑瓜子重要的是节奏，一气呵成</p>
<p>我喜欢奶制品</p>
<p>什么鬼</p>
<p>Mr.rainbow</p>
<p>放心，就算我看了那些还是会比你快</p>
<p>你要是有真迹，他肯定不会</p>
<p>我是麦霸</p>
<p>用户表示体验不佳啊</p>
<p>嘿嘿，你猜我在哪儿</p>
<p>我最高纪录3min</p>
<p>1.0版本的有眼泪</p>
<p>还好，不怎么疼了</p>
<p>我神经比较大条</p>
<p>我可能实时比较敏感，但很快就忘了……</p>
<p>明天还要工作！</p>
<p>你工作很不饱和啊</p>
<p>大概就是记在小本本上以后去实现吧</p>
<p>那不是我一个人喝的</p>
<p>我有999， 可斩感冒</p>
<p>night might</p>
<hr>
<p>Happy birthday，伊丽莎白</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/26/git-clone-repos-with-submodules/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/26/git-clone-repos-with-submodules/" itemprop="url">
                  clone git repos with submodules
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-26T20:01:49+08:00">
                2017-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/26/git-clone-repos-with-submodules/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/26/git-clone-repos-with-submodules/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>当你需要clone的repos中，含有submodules时，我们会用到<code>git clone —recursive</code>这个命令，我今个也遇到了，然后很不幸地掉坑了，一直无法成功clone，Google后，搞定！现附上解答细节。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>先来认识下git中的子模块submodule。</p>
<p>A <strong>submodule</strong> in a git repository is like a sub-directory which is really a separate git repository in its own right. This is a useful feature when you have a project in git which depends on a particular versions of other projects。</p>
<p>我的理解是当你的repos需要依赖于第三方的repos时，可以用submodule的方式，把这些repos作为你的子模块引入进来使用，而这些repos本身仍是独立的。</p>
<p>「添加submodule可以使用命令：<code>git submodule add</code> 后面加上URL即可。」</p>
<p>以clone<a href="https://github.com/strongqa/howitzer_example_cucumber" target="_blank" rel="external">howitzer_example_cucumber</a>为例。可以看到有四个文件长得不大一样，这些其实就是submodule。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmue1wst1nj306i0dat95.jpg" alt=""></p>
<p>如果你直接clone, 使用命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone git@github.com:strongqa/howitzer_example_cucumber.git</div></pre></td></tr></table></figure>
<p>你会发现clone到本地后，那些submodule的文件存在，但里面没有任何文件。</p>
<p>这时就需要添加<code>`--recursive</code> `这个选项，<a href="https://github.com/strongqa/howitzer_example_cucumber" target="_blank" rel="external">howitzer_example_cucumber</a>文档下也列出了命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone --recursive git@github.com:strongqa/howitzer_example_cucumber.git</div></pre></td></tr></table></figure>
<p>终端输入后，报错：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fmuf22enbcj30s303s74w.jpg" alt=""></p>
<p>没有clone成功，显示<code>Permission denied (publickey)</code></p>
<p>google了一下，大部分人都是说修改你的ssh, 可我发现clone其他的repos没问题啊，说明我的ssh没毛病，clone带有submodule的却出问题，被拒绝，肯定跟submodule有关， 应该有其他方法。在stack overflow: <a href="https://stackoverflow.com/questions/39286354/git-clone-recursive-fails/47977557#47977557" target="_blank" rel="external">git clone –recursive fails</a>上找到了最方便的解答。</p>
<p><strong>非常直接：使用https格式</strong></p>
<p>终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone --recursive https://github.com/strongqa/howitzer_example_cucumber</div></pre></td></tr></table></figure>
<p>搞定！</p>
<p>PS. 看了其他文档，发现<strong>还有个方法</strong>，使用<code>git submodule init</code> , <code>git submodule update</code>.</p>
<p> 亲测有效，一并附上：</p>
<p>还是clone上面的repos，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/strongqa/howitzer_example_cucumber</div><div class="line">cd howitzer_example_cucumber</div><div class="line">git submodule init</div><div class="line">git submodule update</div></pre></td></tr></table></figure>
<p>OK  !!</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97" target="_blank" rel="external">Git 工具 - 子模块</a></p>
<p><a href="https://stackoverflow.com/questions/39286354/git-clone-recursive-fails/47977557#47977557" target="_blank" rel="external">git clone –recursive fails</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/25/concepts-in-howitzer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/25/concepts-in-howitzer/" itemprop="url">
                  有关Howitzer中的几个概念
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-25T20:03:42+08:00">
                2017-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Howitzer/" itemprop="url" rel="index">
                    <span itemprop="name">Howitzer</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/25/concepts-in-howitzer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/25/concepts-in-howitzer/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="http://howitzer-framework.io/" target="_blank" rel="external">howitzer</a>是一个基于ruby脚本的web验收测试框架， 初学时，对这个新伙伴是不甚了解，按照老规矩，看doc，看API。看完后，结合自己的理解，简单过一下里面几个重要的概念。</p>
<p>基本思路：</p>
<blockquote>
<ul>
<li>是什么？</li>
<li>怎么用？</li>
<li>用的时候要注意什么？</li>
</ul>
</blockquote>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>Driver</p>
<blockquote>
<p>是一个针对多个浏览器进行测试的通用界面，所有的Driver可以分成两类：</p>
<ul>
<li>Headless testing: 没有用户操作界面的模拟浏览器</li>
<li>real browser testing: 通过扩展程序或者插件来与真实的浏览器进行集成</li>
</ul>
</blockquote>
<p>Howitzer使用Capybara来对driver进行管理和设置，可以在<code>config/default.yml</code>中进行设置</p>
</li>
<li><p>Pages</p>
<p>介绍pages之前，介绍一下Page Object Model。</p>
<p>Page Object Model是一个自动化测试模版，创建用于测试的用户界面的抽象实体。可以将网站的每个page看作是一个类，然后通过调用这些类的实例来进行测试，而每个页面的元素可以看作是一个page的method，通过调用这些method来对该页面的元素进行调用。</p>
<p>这样，page就很好理解了。</p>
<p>Page是用于描述真实页面的类，比如在<code>web/pages</code>目录下，建立主页的文件，可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Homepage &lt; Howitzer::Web::Page</div><div class="line">path &apos;/&apos;</div><div class="line">end</div><div class="line">HomePage.open #打开主页</div></pre></td></tr></table></figure>
<p>当然，这里的前提是你在<code>config/default.yml</code>中已经设置好了app_host</p>
<p>再比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class ProductPage &lt; Howitzer::Web::Page</div><div class="line">  path &apos;/products&#123;/id&#125;&apos;</div><div class="line">end</div><div class="line">ProductPage.open(id: 1) #=&gt; 访问 /products/1</div></pre></td></tr></table></figure>
<p>如果要指定特定的host，可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class AuthPage &lt; Howitzer::Web::Page</div><div class="line">	site &apos;https://example.com&apos;</div><div class="line">	path &apos;/auth&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p><strong>Pages的验证：</strong></p>
<p>其实就是用于区分每个page的anchor，有三种不同的类型：</p>
<p><strong>URL，title，element</strong></p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  path &apos;/&apos;</div><div class="line">  validate :url, /\A(?:.*?:\/\/)?[^\/]*\/?\z/</div><div class="line">end</div></pre></td></tr></table></figure>
<p>使用<code>.displayed?</code>可以去判断一个页面的所有验证是否都通过。</p>
<p>用这个可以检查特定的页面成功打开，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class AccountPage &lt; Howitzer::Web::Page</div><div class="line">  path &apos;/accounts/&#123;id&#125;&apos;</div><div class="line"> end</div><div class="line"> AccountPage.open(id: 22)</div><div class="line"> expect(AccountPage).to be_displayed</div></pre></td></tr></table></figure>
</li>
<li><p>Elements</p>
<p>页面的元素，可以是单个元素，比如搜索栏，也可以是元素集合，比如菜单中的选项集。</p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  element :test_name1, &apos;.foo&apos;                         #css locator, default</div><div class="line">  element :test_name2, :css, &apos;.foo&apos;                   #css locator</div><div class="line">  element :test_name3, :xpath, &apos;//div[@value=&quot;bar&quot;]&apos;  #xpath locator</div><div class="line"></div><div class="line">  element :test_link1, :link, &apos;Foo&apos;                   #link locator by &apos;Foo&apos; text</div><div class="line">  element :test_link2, :link, &apos;bar&apos;                   #link locator by &apos;bar&apos; id</div><div class="line"></div><div class="line">  element :test_field1, :fillable_field, &apos;Foo&apos;        #field locator by &apos;Foo&apos; text</div><div class="line">  element :test_field2, :fillable_field, &apos;bar&apos;        #field locator by &apos;bar&apos; id</div><div class="line">  element :test_field3, :fillable_field, &apos;baz&apos;        #field locator by &apos;baz&apos; name</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这里要注意，不能通过page类直接调用element，需要在page类中定义一个method来调用element。</p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  element :new_button, :xpath, &quot;.//*[@name=&apos;New&apos;]&quot;</div><div class="line"></div><div class="line">  def start_new_project</div><div class="line">    new_button_element.click</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">HomePage.on &#123; new_button_element.click &#125; # 不正确的用法</div><div class="line">HomePage.on &#123; start_new_project &#125; # 正确的打开方式</div></pre></td></tr></table></figure>
</li>
<li><p>Sections</p>
<p>在howitzer中，有一个Howitzer::Web::Section类。</p>
<p>section的使用场景：当多个页面中出现相同的部分时，或者某部分在一个页面中频繁出现，类似rails中的公用表单。</p>
<p>使用<code>&lt;section_name&gt;_section</code>来生成一个section的实例,  这里使用一个特别的me方法，通过参数指定section，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;#gbx3&quot; #section的父元素</div><div class="line">end</div></pre></td></tr></table></figure>
<p>使用的时候，这么用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 定义section:</div><div class="line"></div><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;#gbx3&quot;</div><div class="line">end</div><div class="line"></div><div class="line"># 包含menusection的页面:</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :menu</div><div class="line">end</div><div class="line"></div><div class="line"># 页面调用section:</div><div class="line"></div><div class="line">HomePage.on &#123; menu_section &#125;</div></pre></td></tr></table></figure>
<p>当两个页面有相同的section，但是跟节点不同时，可以这么用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 定义section</div><div class="line"></div><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &apos;#gbx3&apos;</div><div class="line">end</div><div class="line"></div><div class="line"># 定义两个page类，都包含有menu这个section</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :menu # 使用默认的selector</div><div class="line">end</div><div class="line"></div><div class="line">class SearchResultsPage &lt; Howitzer::Web::Page</div><div class="line">  section :menu, &quot;#gbx48&quot; # 覆盖了默认的selector</div><div class="line">end</div></pre></td></tr></table></figure>
<p>测试section是否存在某个页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &apos;#gbx3&apos;</div><div class="line">  element :search, &quot;a.search&quot;</div><div class="line">end</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :menu</div><div class="line">end</div><div class="line"></div><div class="line">HomePage.on &#123; has_menu_section? &#125; #=&gt; returns true or false</div></pre></td></tr></table></figure>
<p>多层级section的使用，看一个登陆的例子，结合了cucumber 的step定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"># define a page that contains an area that contains a section for both logging in and registration, then modeling each of the sub sections separately</div><div class="line"></div><div class="line">class LoginSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;div.login-area&quot;</div><div class="line">  element :username, &quot;#username&quot;</div><div class="line">  element :password, &quot;#password&quot;</div><div class="line">  element :sign_in, &quot;button&quot;</div><div class="line"></div><div class="line">  def login(username, password)</div><div class="line">    username_element.set username</div><div class="line">    password_element.set password</div><div class="line">    sign_in_element.click</div><div class="line">  end  </div><div class="line">end</div><div class="line"></div><div class="line">class RegistrationSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;div.reg-area&quot;</div><div class="line">  element :first_name, &quot;#first_name&quot;</div><div class="line">  element :last_name, &quot;#last_name&quot;</div><div class="line">  element :next_step, &quot;button.next-reg-step&quot;</div><div class="line"></div><div class="line">  def sign_up(first_name, last_name)</div><div class="line">    first_name_element.set first_name</div><div class="line">    first_name_element.set last_name</div><div class="line">    next_step_element.click</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">class LoginRegistrationFormSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;div.login-registration&quot;</div><div class="line">  section :login</div><div class="line">  section :registration  </div><div class="line">end</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :login_and_registration</div><div class="line">end</div><div class="line"></div><div class="line"># how to login (fatuous, but demonstrates the point):</div><div class="line">Then /^I sign in$/ do</div><div class="line">  HomePage.open</div><div class="line">  HomePage.on do</div><div class="line">    is_expected.to have_login_and_registration_section</div><div class="line">    login_and_registration_section.login_section.login(&apos;bob&apos;, &apos;p4ssw0rd&apos;)</div><div class="line">  end  </div><div class="line">end</div><div class="line"></div><div class="line"># how to sign up:</div><div class="line"></div><div class="line">When /^I enter my name into the home page&apos;s registration form$/ do</div><div class="line">  HomePage.open</div><div class="line">  HomePage.on do</div><div class="line">    expect(login_and_registration_section.registration_section).to have_first_name</div><div class="line">    expect(login_and_registration_section.registration_section).to have_last_name</div><div class="line">    login_and_registration_section.registration_section.signup(&apos;Bob&apos;, &apos;Arum&apos;)</div><div class="line">  end  </div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>IFrames</p>
<p>IFrames 在howitzer中被声明为一个 <code>Howitzer::Web::Page</code>类，通过包含该frame 的section或者page来引用，比如：</p>
<p>创建一个frame实例，在DashboardPage中引用它，测试该frame是否在DashboardPage中存在。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class FbPage &lt; Howitzer::Web::Page</div><div class="line">  element :some_text_field, &quot;input.username&quot;</div><div class="line">end</div><div class="line"></div><div class="line">class DashboardPage &lt; Howitzer::Web::Page</div><div class="line">  iframe :fb, &quot;#fb&quot;</div><div class="line">end</div><div class="line"></div><div class="line">DashboardPage.open</div><div class="line">DashboardPage.on &#123; is_expected.to have_fb_iframe &#125;</div></pre></td></tr></table></figure>
<p>与iframe中的元素进行交互, 这里用了cucumber login的step definition来说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"># Howitzer::Web::Page representing the iframe</div><div class="line">class LoginPage &lt; Howitzer::Web::Page</div><div class="line">  element :username, &quot;input.username&quot;</div><div class="line">  element :password, &quot;input.password&quot;</div><div class="line"></div><div class="line">  def login(username, password)</div><div class="line">    username_element.set username</div><div class="line">    password_element.set password</div><div class="line">  end  </div><div class="line">end</div><div class="line"></div><div class="line"># Howitzer::Web::Page representing the page that contains the iframe</div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  iframe :login, &quot;#login_and_registration&quot;</div><div class="line">end</div><div class="line"></div><div class="line"># cucumber step that performs login</div><div class="line">When /^I log in$/ do</div><div class="line">  HomePage.open</div><div class="line">  HomePage.on do</div><div class="line">    login_iframe do |frame|</div><div class="line">      #`frame` is an instance of the `LoginPage` class</div><div class="line">      frame.login(&apos;admin&apos;, &apos;p4ssword&apos;)</div><div class="line">    end</div><div class="line">  end  </div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>参考：</p>
<p><a href="http://docs.howitzer-framework.io/" target="_blank" rel="external">howitzer doc</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/17/use-simple-navigation-in-rails/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/17/use-simple-navigation-in-rails/" itemprop="url">
                  在rails中使用simple navigation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-17T17:31:24+08:00">
                2017-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/17/use-simple-navigation-in-rails/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/17/use-simple-navigation-in-rails/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="https://github.com/codeplant/simple-navigation" target="_blank" rel="external">simple navigation</a>是一个ruby库，用来生成navigation的，它的优势是可以定制自己的导航菜单，特别是当你有多个菜单或者你的菜单相对比较复杂的时候。</p>
<p>可是官方只是给出了一个<a href="http://simple-navigation-demo.codeplant.ch/" target="_blank" rel="external">online demo</a>，并没有给到具体的install  和 usage，这让初次接触simple navigation的小白有些被动，Google了一些文章，实做了一下，知道怎么玩啦，记录下以备用。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>安装gem</p>
<p>在gemfile文件中，添加如下：【建议把bootstrap也安装了】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gem &apos;bootstrap-sass&apos;</div><div class="line">gem &apos;simple-navigation&apos;</div><div class="line">gem &apos;simple-navigation-bootstrap&apos;</div></pre></td></tr></table></figure>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle install</div></pre></td></tr></table></figure>
<p>重启服务器：<code>rails s</code></p>
<p>将<code>application.css</code>文件更名为<code>application.scss</code>，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv app/assets/stylesheets/application.css app/assets/stylesheets/application.scss</div></pre></td></tr></table></figure>
<p>在<code>application.scss</code>文件中，添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@import &quot;bootstrap-sprockets&quot;;</div><div class="line">@import &quot;bootstrap&quot;;</div></pre></td></tr></table></figure>
<p>生成menu 的configuration文件<code>navigation.rb</code>， 终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle exec rails g navigation_config</div></pre></td></tr></table></figure>
<p>此时，config文件下会生成一个<code>navigation.rb</code>文件，长这样：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fmjtnki6lbj30o007tmyr.jpg" alt=""></p>
<p>在文件的下方，已经列出了一些用法，包括如何添加有sub navigation的item，添加指定条件的item，比如登陆，是否为管理员等等。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjtwnw2dzj30nv0gb42w.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>设置menu</p>
<p>我们来改改，定制一下，比如下面这样：【当然，请确保你写的path是有效的……】</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjvdavg84j30le04n74t.jpg" alt=""></p>
</li>
<li><p>展示menu</p>
<p>在需要展示的页面中，添加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render_navigation(:expand_all =&gt; true)%&gt;</div></pre></td></tr></table></figure>
<p>这里，expand_all 为true是指全部铺开，即子菜单未被激活也是展开的，效果类似这样：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fmjve7qr4oj305z04it8l.jpg" alt=""></p>
<p>这里可以用参数level来控制层级的显示，上面菜单 + 子菜单，只有两级，所以用</p>
<p><code>render_navigation(:level =&gt; 2)</code>也是可以的。如果改成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render_navigation(:level =&gt; 1)%&gt;</div></pre></td></tr></table></figure>
<p>则显示一级菜单，像这样：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjvz5s8kej3063027q2r.jpg" alt=""></p>
<p>另：</p>
<p>看到GitHub 中提到使用<code>&lt;%= render_navigation(:expand_all =&gt; false)%&gt;</code> 来让未被激活的子菜单隐藏，没有设置的情况下，:expand_all是默认为false的, 我试了一下，没有成功，所有菜单还是全部铺开，有些奇怪。</p>
</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://github.com/codeplant/simple-navigation" target="_blank" rel="external">simple-navigation</a></p>
<p><a href="https://github.com/pdf/simple-navigation-bootstrap" target="_blank" rel="external">simple-navigation-bootstrap</a></p>
<p><a href="http://www.xoen.org/2012/05/bootstrap-menus-in-rails/" target="_blank" rel="external">bootstrap menu in rails</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/13/methods-of-Array-in-Ruby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/13/methods-of-Array-in-Ruby/" itemprop="url">
                  Ruby中Array 的一些常用方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T17:11:08+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/13/methods-of-Array-in-Ruby/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/13/methods-of-Array-in-Ruby/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>工作中常常要处理Array，索性把ruby 中Array的一些常用方法小结一下，加深印象。</p>
<p>先来看看Array中除去继承自Object之外的，有多少public methods</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(Array.instance_methods - Object.instance_methods).count</div><div class="line"># 输出:</div><div class="line">120</div><div class="line"># ruby版本为 2.3.1</div></pre></td></tr></table></figure>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>建立空数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[]</div><div class="line">Array.new</div></pre></td></tr></table></figure>
</li>
<li><p>使用%w, %i 创建非空数组</p>
<p><strong>创建不包含空白的字符串数组，可用%w</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%w(Ruby Python Scheme)</div><div class="line"># 输出:</div><div class="line">[&quot;Ruby&quot;, &quot;Python&quot;, &quot;Scheme&quot;]</div></pre></td></tr></table></figure>
<p><strong>创建元素为符号的数组，可用%i</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%i(Ruby Python Scheme)</div><div class="line"># 输出:</div><div class="line">[:Ruby, :Python, :Scheme]</div></pre></td></tr></table></figure>
</li>
<li><p>数组的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[4, 8, 15, 16, 23, 42].count</div><div class="line">[4, 8, 15, 16, 23, 42].size</div><div class="line">[4, 8, 15, 16, 23, 42].length</div><div class="line"># 输出:</div><div class="line">6</div><div class="line">6</div><div class="line">6</div></pre></td></tr></table></figure>
</li>
<li><p>将string转化为array</p>
<p> split</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&quot;a, b, c, d&quot;.split(&quot;, &quot;)</div><div class="line"># 输出:</div><div class="line">[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</div></pre></td></tr></table></figure>
</li>
<li><p>将array转化为string</p>
<p>join</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;].join(&quot;, &quot;)</div><div class="line"># 输出:</div><div class="line">&quot;a, b, c, d&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>将hash 转化为array</p>
<p>to_a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">table = &#123;:&quot;color1&quot; =&gt; &quot;blue&quot;, :&quot;color2&quot; =&gt; &quot;red&quot;&#125;</div><div class="line">table.to_a</div><div class="line"># 输出:</div><div class="line">[[:color1, &quot;blue&quot;], [:color2, &quot;red&quot;]]</div><div class="line"></div><div class="line">table.to_a.flatten</div><div class="line"># 输出:</div><div class="line">[:color1, &quot;blue&quot;, :color2, &quot;red&quot;]</div></pre></td></tr></table></figure>
</li>
<li><p>在数组中提取元素</p>
<p>index从0开始，index为正时，从array的第一个元素开始，index为负时，从最后一个元素开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5][2]</div><div class="line"># 输出:</div><div class="line">3</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5][-1]</div><div class="line"># 输出:</div><div class="line">5</div></pre></td></tr></table></figure>
</li>
<li><p>给数组添加元素</p>
<p>在尾部添加&lt;&lt;  or push</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5] &lt;&lt; &quot;woot&quot;</div><div class="line"># 输出: [1, 2, 3, 4, 5, &quot;woot&quot;]</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5].push(&quot;woot&quot;)</div><div class="line"># 输出: [1, 2, 3, 4, 5, &quot;woot&quot;]</div></pre></td></tr></table></figure>
<p>在开头添加 unshift</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5].unshift(0)</div><div class="line"># 输出:</div><div class="line">[0, 1, 2, 3, 4, 5]</div></pre></td></tr></table></figure>
</li>
<li><p>连接数组concat ／ +</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5].concat([6, 7])</div><div class="line"># 输出:</div><div class="line">[1, 2, 3, 4, 5, 6, 7]</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5] + [6, 7]</div><div class="line"># 输出:</div><div class="line">[1, 2, 3, 4, 5, 6, 7]</div></pre></td></tr></table></figure>
</li>
<li><p>数组转换map, collect</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5].map &#123;|x| x * 3&#125;</div><div class="line"># 输出:</div><div class="line">[3, 6, 9, 12, 15]</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5].collect &#123;|x| x + 2 &#125;</div><div class="line"># 输出:</div><div class="line">[3, 4, 5, 6, 7]</div></pre></td></tr></table></figure>
</li>
<li><p>获取分散的数组values_at</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[1,2,3,4,5,6].values_at(1,2,4)</div><div class="line"># 输出:</div><div class="line">[2, 3, 5]</div></pre></td></tr></table></figure>
</li>
<li><p>筛选特定的元素 select</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[1,2,3,4,5,6].select &#123;|number| number % 2 == 0&#125;</div><div class="line"># 输出:</div><div class="line">[2, 4, 6]</div></pre></td></tr></table></figure>
</li>
<li><p>删除元素 delete</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7]</div><div class="line">a.delete(5) # 注意这里delete的参数是元素，不是index</div><div class="line"># 输出:</div><div class="line">5</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1, 3, 4, 6, 7]</div></pre></td></tr></table></figure>
<p>删除指定index的元素delete_at 【破坏性修改】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7]</div><div class="line">a.delete_at(5)</div><div class="line"># 输出:</div><div class="line">7</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,3,5,4,6]</div></pre></td></tr></table></figure>
<p>删除符合要求的delete_if【破坏性修改】, reject</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1,2,3,4,5,6,7,8,9].delete_if&#123;|x| x % 2 == 0&#125;</div><div class="line"># 输出:</div><div class="line">[1, 3, 5, 7, 9]</div><div class="line"></div><div class="line">[1,2,3,4,5,6,7,8,9].reject&#123;|x| x % 2 == 0&#125;</div><div class="line"># 输出:</div><div class="line">[1, 3, 5, 7, 9]</div></pre></td></tr></table></figure>
<p>删除所有nil元素compact</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [nil, 4, nil, 8, 15, 16, nil, 23, 42, nil]</div><div class="line">a.compact</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, 23, 42]</div></pre></td></tr></table></figure>
<p>删除指定部分slice</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7]</div><div class="line">a.slice(1,2)</div><div class="line"># 输出:</div><div class="line">[3, 5]</div><div class="line"></div><div class="line">a.slice!(1,2)</div><div class="line"># 输出:</div><div class="line">[3, 5]</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1, 4, 6, 7]</div></pre></td></tr></table></figure>
<p>删除第X个元素shift, 默认是第一个【破坏性修改】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6,7,8,9]</div><div class="line">a.shift</div><div class="line"># 输出:</div><div class="line">1</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[2, 3, 4, 5, 6, 7, 8, 9]</div><div class="line"></div><div class="line">a.shift(2)</div><div class="line"># 输出:</div><div class="line">[2, 3]</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[ 4, 5, 6, 7, 8, 9]</div></pre></td></tr></table></figure>
<p>删除最后X个元素pop ，默认是最后一个【破坏性修改】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6,7,8,9]</div><div class="line">a.pop</div><div class="line"># 输出:</div><div class="line">9</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,2,3,4,5,6,7,8]</div><div class="line"></div><div class="line">a.pop(3)</div><div class="line"># 输出:</div><div class="line">[6,7,8]</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,2,3,4,5]</div></pre></td></tr></table></figure>
<p>ruby中method后面带有！符号的都是具有破坏性的修改, 但是那些没有带！尾巴的也不是那么友好，比如上面的shift， pop。 那么可有办法保护我们的array？有滴，上freeze</p>
<p>freeze可以禁止具有破坏性的方法来修改对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6,7,8,9]</div><div class="line">a.freeze</div><div class="line">a.pop</div><div class="line"># 输出:</div><div class="line">can&apos;t modify frozen Array</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,2,3,4,5,6,7,8,9]</div></pre></td></tr></table></figure>
</li>
<li><p>去除重复元素uniq</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7,1,3,7]</div><div class="line">a.uniq</div><div class="line"># 输出:</div><div class="line">[1, 3, 5, 4, 6, 7]</div></pre></td></tr></table></figure>
</li>
<li><p>平坦化数组flatten</p>
<p>前面出现过，再多看些例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[4, [8], [15], [16, [23, 42]]].flatten</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, 23, 42]</div></pre></td></tr></table></figure>
<p>不传递参数时，默认是完全平坦化，传递参数，则平坦化层级X，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[4, [8], [15], [16, [23, [42, 43]]]].flatten(1)</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, [23, [42, 43]]]</div><div class="line"></div><div class="line">[4, [8], [15], [16, [23, [42, 43]]]].flatten(2)</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, 23, [42, 43]]</div><div class="line"></div><div class="line">[4, [8], [15], [16, [23, [42, 43]]]].flatten(3)</div><div class="line"># 输出:</div><div class="line"> [4, 8, 15, 16, 23, 42, 43]</div></pre></td></tr></table></figure>
</li>
<li><p>获取某个元素的出现次数count</p>
<p>count前面已经出现过，用于计算数组的长度，不带参数，如果传递参数给到count，则返回该元素在数组中出现的次数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[42, 8, 15, 16, 23, 42].count(42)</div><div class="line"># 输出:</div><div class="line">2</div></pre></td></tr></table></figure>
</li>
<li><p>排序sort</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [1, 3, 5, 4, 6, 7]</div><div class="line">a.sort</div><div class="line"># 输出:</div><div class="line"> [1, 3, 4, 5, 6, 7]</div></pre></td></tr></table></figure>
<p>使用块来指定排序规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [&quot;ruby&quot;, &quot;python&quot;, &quot;C&quot;, &quot;C++&quot;, &quot;java&quot;]</div><div class="line">a.sort</div><div class="line"># 输出:</div><div class="line">[&quot;C&quot;, &quot;C++&quot;, &quot;java&quot;, &quot;python&quot;, &quot;ruby&quot;]    # 默认按照首字母排序</div><div class="line"></div><div class="line">a.sort &#123;|a, b| a.length &lt;=&gt; b.length&#125;</div><div class="line"># 输出:</div><div class="line">[&quot;C&quot;, &quot;C++&quot;, &quot;ruby&quot;, &quot;java&quot;, &quot;python&quot;]   # 按照字符长度来排序</div></pre></td></tr></table></figure>
<p>同样的，sort！方法具有破坏性。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>先整这么多，用到新的再补上，嘿哈</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/06/about-music/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/06/about-music/" itemprop="url">
                  关于听歌这件事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-06T19:55:29+08:00">
                2017-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/闲言碎语/" itemprop="url" rel="index">
                    <span itemprop="name">闲言碎语</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>送君一掬温柔</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=28921691&auto=1&height=66"></iframe>

<p>一直觉得音乐是个特别神奇的东西。</p>
<p>无形无色，却能有着撩拨人心的力量。</p>
<p>开心了，听歌助兴，不开心了，听歌释怀。</p>
<p>疲惫时，一首歌，仿佛能治愈，能满血复活。</p>
<p>晴朗的日子里，踩着单车，塞上耳机，哼歌吹哨，真真是享受。</p>
<p>记得《偷影子的人》中，男主有个嗜好，每天早上都要来一段大提琴曲，而他最终找到了那个有着大提琴音色般笑声的克蕾尔，彼时她已经是一名大提琴家。</p>
<p>也许耳朵才是抵达心灵的窗口。</p>
<p>嗯，深情不过陪伴，温柔最是得人心。</p>
<p>愿你在音符中寻觅到那份温暖与温柔。</p>
<p>好了，不矫情了，听歌吧。</p>
<p>PS：</p>
<p>为什么要写这么一篇小短文？</p>
<p>其实，我只是想试试如何在hexo里面添加音乐文件……</p>
<p>事实证明，可以边看文章边听歌了……</p>
<p>嗯，其实，还是一心一意听歌的好，好音乐值得去专注。</p>
<hr>
<p>参考：</p>
<p><a href="http://www.jianshu.com/p/a52b68794a6b" target="_blank" rel="external">hexo创建个人博客（附加插入音乐、分享、评论、标签页、搜索）</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/source/images/avatar.jpg"
               alt="Lucia" />
          <p class="site-author-name" itemprop="name">Lucia</p>
           
              <p class="site-description motion-element" itemprop="description">Learning is doing</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="Link" target="_blank" title="LinkLabel">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkLabel
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lupeipei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/Luciapeipei" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-lupeipei-github-io.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
